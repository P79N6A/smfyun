
<link rel="stylesheet" href="/qwt/assets/css/amazeui.datetimepicker.css"/>
<style type="text/css">
    #datetimepicker1{
        display: inline-block;
    width: 150px;
    text-align: center;
    border: 1px solid #e5e5e5;
    border-radius: 5px;
    height: 38px;
    }
    #datetimepicker2{
        display: inline-block;
    width: 150px;
    text-align: center;
    border: 1px solid #e5e5e5;
    border-radius: 5px;
    height: 38px;
    }
    .search-btn1{
        display: inline-block;
        background-color: white;
    border-radius: 5px;
    border: 1px solid #e5e5e5;
    color: black;
    border-top-left-radius: 5px !important;
    border-bottom-left-radius: 5px !important;
    }

.nav-tabs-custom>.nav-tabs>li.active {
  border-top-color: #00a65a;
}
.nav-tabs-custom>.nav-tabs>li.active {
    border-top-color: #00a65a;
  }
  .reduce,.add{
    font-size: 14px;
    position: relative;
    bottom: 10px;
  }
  .add{
    margin-left: 20px;
    margin-right: 30px;
  }
  .loc{
    margin-top: 5px;
    margin-bottom: 5px;
  }
.box-header .buyflow{
  padding: 8px;
  border-radius: 8px;
  border: 1px solid #dedede;
  width: 100%;
  font-size: 18px;
}
.label {font-size: 14px}
th, td{
  text-align: center;
}
.mask{
    position: fixed;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    display: -webkit-box;
    -webkit-box-pack: center;
    -webkit-box-align: center;
    z-index: 10000;
    background-color: rgba(0, 0, 0, .7);
    -webkit-animation: fadeIn .6s ease;
    color: rgba(255,255,255,.7);
    font-family: 'Source Sans Pro','Helvetica Neue',Helvetica,Arial,sans-serif;
    font-weight: 400;
    font-size: 14px;
}
.payment{
  position: fixed;
  background-color: #fff;
  width: 500px;
  height: 400px;
  top: 20%;
  left: 50%;
  margin-left: -250px;
  color: #000;
  border-radius: 5px;
}
.payment-hd,.payment-bd,.payment-lg,.payment-ft{
  width: 100%;
  text-align: center;
  margin-top: 10px;
}
.close{
  margin-top: 5px;
  margin-right: 10px;
    float: right;
    font-size: 21px;
    font-weight: 700;
    line-height: 1;
    color: #000;
    text-shadow: 0 1px 0 #fff;
    filter: alpha(opacity=20);
    opacity: .2;
}
.payment-hd{
  display: inline-block;
  text-align: left;
  margin-left: 80px;
}
.payment-lg img{
  padding: 5px;
  border: 1px solid #d5d5d5;
  width: 150;
  height: 150px;
}
.payment-bd{
  height: 44px;
  line-height: 44px;
}
.price-left,.flow-left{
  float: left;
  text-align: right;
  width: 150px;
}
.price-num,.flow-num{
  float: left;
  text-align: left;
  padding-left: 5px;
  font-size: 28px;
  color: #ff6600;
}
.price-right,.flow-right{
  float: left;
  text-align: right;
  width: 25px;
}
.subtips{
  color: #777777;
}
input{
  padding: 10px 6px;
  line-height: 10px;
}
.explain{
  background-color: #445e84;
  padding-top: 2px;
  width: 150px;
  display: inline-block;
}
.controls{
  display: inline-block;
}
.selected .radio-box{

    color: #608908;
    background: #ffffff;
    border: 2px solid #a5c85b;
    padding: 7px 9px;
    outline: 0;
}
.radio-box{
display: block;
    color: #555555;
    background: #f5f5f5;
    border: 1px solid #cfcfcf;
    padding: 8px 10px;
    text-decoration: none;
}
.selectedf .radio-boxf{

    color: #608908;
    background: #ffffff;
    border: 2px solid #a5c85b;
    padding: 7px 9px;
    outline: 0;
}
.radio-boxf{
display: block;
    color: #555555;
    background: #f5f5f5;
    border: 1px solid #cfcfcf;
    padding: 8px 10px;
    text-decoration: none;
}
.close{
  margin-top: 5px;
  margin-right: 10px;
}
   .demo{
    padding:0;
      }
      .progress{
        height: 25px;
        background: #262626;
        padding: 5px;
        overflow: visible;
        border-radius: 20px;
        border-top: 1px solid #000;
        border-bottom: 1px solid #7992a8;
        margin-top: 50px;
      }
      .progress .progress-bar{
        border-radius: 20px;
        position: relative;
        animation: animate-positive 2s;
      }
      .progress .progress-value{
        display: block;
        padding: 3px 7px;
        font-size: 13px;
        color: #fff;
        border-radius: 4px;
        background: #191919;
        border: 1px solid #000;
        position: absolute;
        top: -40px;
        right: -30px;
      }
      .progress .progress-value:after{
        content: "";
        border-top: 10px solid #191919;
        border-left: 10px solid transparent;
        border-right: 10px solid transparent;
        position: absolute;
        bottom: -6px;
        left: 26%;
      }
      .progress-bar.active{
        animation: reverse progress-bar-stripes 0.40s linear infinite, animate-positive 2s;
      }
      @-webkit-keyframes animate-positive{
        0% { width: 0; }
      }
      @keyframes animate-positive{
        0% { width: 0; }
      }
.flowuse{
  font-size: 18px;
  margin-left: 15px;
  height: 40px;
}
.flowuse span{
  padding: 10px 20px;
  border-radius: 3px;
  background-color: #dd4b39;
  color: #fff;
  display: block;
  width: 270px;
  text-align: center;
}
.enter{
  display: inline-block;
  float: right;
  margin-top: 5px;
  margin-right: 80px;
}
</style>

  <div class="tpl-page-container tpl-page-header-fixed">
        <div class="tpl-content-wrapper">
            <div class="tpl-content-page-title">
                购买流量
            </div>
            <ol class="am-breadcrumb">
                <li><a class="am-icon-home">神码云直播</a></li>
                <li><a>会员中心</a></li>
                <li><a>直播流量中心</a></li>
                <li class="am-active">购买流量</li>
            </ol>
            <div class="tpl-portlet-components">
                    <div class="tpl-portlet">
                        <div class="tpl-portlet-title">

                        </div>

                        <div class="am-tabs tpl-index-tabs" data-am-tabs>
                            <ul class="am-nav am-nav-tabs" style="left:0;">
              <li class="am-active"><a href="">购买流量</a></li>
              <li><a href="/qwtwzba/flowcenter_history">流量消耗记录</a></li>
                            </ul>

                            <div class="am-tabs-bd" style="overflow:visible;">
                                <div class="am-tab-panel am-fade am-in am-active">
                                    <div id="wrapperA" class="wrapper" style="overflow:visible;">
<form method="get" name="loginsform">


  <div class="am-form-group" style="margin-bottom:10px;">
    <div class="col-xs-12">
            <div class="box-header">
            <?php if($all>0):?>
              <div class="demo">
                <div class="container" style="width:100%">
                  <div class="am-form-group">
                    <div class="col-md-offset-3 col-md-6" style="margin-left:0;width:300px">
                      <div class="progress">
                        <div class="progress-bar progress-bar-danger progress-bar-striped active" style="width: <?=number_format((($use/(1024*1024*1024))/$all)*100,2)?>%;">
                          <div class="progress-value"><?=number_format((($use/(1024*1024*1024))/$all)*100,2)?>%</div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="flowuse"><span>已使用<?=number_format($use/(1024*1024*1024),2)?>G/<?=$all?>G</span></div>
            <?php else:?>
              <div class="flowuse"><span>您还没有购买流量！</div>
            <?php endif?>
            <?php if($use/(1024*1024*1024)>$all&&$all>0):?>
              <div class="flowuse"><span>您的流量已经使用完毕！</div>
            <?php endif?>
            </div><!-- /.box-header -->
    </div>
  </div>
  <div class="row">
    <div class="col-xs-12" style="margin-left:25px;padding-top:10px;border-top:1px solid #f4f4f4;width:300px;">
      <a id="flowperchase" class="am-btn am-btn-success pull-left" style="margin-bottom:10px;"> <span>购买流量</span></a>
      <a id="caculator" class="am-btn am-btn-success pull-left" style=";margin-bottom:10px;margin-left:50px;"> <span>流量计算器</span></a>
    </div>
  </div>

</form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tpl-alert"></div>
            </div>
<div class="mask buybox" style="display:none">
  <div class="payment">
    <div class="close">X</div>
    <div class="payment-hd" style="display:flex;margin-top:0;">
      <span>充值数量：</span>
      <div class="controls">
        <label data-action="updateAmount" data-value="60" class="selectedf" data-type='100GB'><a class="radio-boxf" href="javascript:void(0);">100GB</a></label>
        <label data-action="updateAmount" data-value="275" data-type='500GB'><a class="radio-boxf" href="javascript:void(0);">500GB</a></label>
        <label data-action="updateAmount" data-value="542.72" data-type='1TB'><a class="radio-boxf" href="javascript:void(0);">1TB</a></label>
        <label data-action="updateAmount" data-value="2611.2" data-type='5TB'><a class="radio-boxf" href="javascript:void(0);">5TB</a></label><br>
        <label data-action="updateAmount" data-value="5017.6" data-type='10TB'><a class="radio-boxf" href="javascript:void(0);">10TB</a></label>
        <label data-action="updateAmount" data-value="24064" data-type='50TB'><a class="radio-boxf" href="javascript:void(0);">50TB</a></label>
        <label data-action="updateAmount" data-value="46080" data-type='100TB'><a class="radio-boxf" href="javascript:void(0);">100TB</a></label>
      </div>
      <!-- <input id='stream_data' class="flownum" type="number" onkeyup="this.value=this.value.replace(/\D/g,'')" onafterpaste="this.value=this.value.replace(/\D/g,'')" ></input>
      <span>GB</span> -->
    </div>
      <span class="subtips" style="margin-left:80px">(1TB=1024GB 1GB=1024MB 1MB=1024KB)</span>
    <div class="payment-bd">
      <span class="price-left">应付金额：</span>
      <span class="price-num" id='pricef-num'>60</span>
      <span class="price-right">元</span>
    </div>
    <div class="payment-lg" id='payment-lg'>
    </div>
    <div class="payment-ft" id="payment-ft" style="display:none">
      <p class="explain">
        <img src="http://imgcache.qq.com/bossweb/ipay/images/pay/tips-rwm.png">
      </p>
    </div>
  </div>
</div>
<div class="mask caculator" style="display:none">
  <div class="payment">
    <div class="close">X</div>
    <div class="payment-hd" style="text-align:left; margin-left:100px;">
      <span>视&nbsp;&nbsp;&nbsp;频&nbsp;&nbsp;码&nbsp;&nbsp;率：</span>
      <div class="controls">
        <label data-action="updateAmount" data-value="1000" class="selected"><a class="radio-box" href="javascript:void(0);">普清</a></label>
        <label data-action="updateAmount" data-value="1600"><a class="radio-box" href="javascript:void(0);">高清</a></label>
        <label data-action="updateAmount" data-value="2600"><a class="radio-box" href="javascript:void(0);">超清</a></label>
      </div>
    </div>
    <div class="payment-bd" style="text-align:left; margin-left:100px;">
      <span>直&nbsp;&nbsp;&nbsp;播&nbsp;&nbsp;时&nbsp;&nbsp;长：</span>
      <input id='live-length' style="border:1px solid #dedede;" class="flownum" type="text" onkeyup="value=value.replace(/[^\d]/g,'') " ></input>
      <span>分钟</span>
    </div>
    <div class="payment-lg" style="text-align:left; margin-left:100px;">
      <span>同时在线人数：</span>
      <input id='live-num' style="border:1px solid #dedede;" class="flownum" type="text" onkeyup="value=value.replace(/[^\d]/g,'') " ></input>
      <span>人</span>
    </div>
    <div class="payment-bd" style="text-align:left; margin-left:100px;">
      <span class="flow-left" style="width:auto">预&nbsp;&nbsp;&nbsp;计&nbsp;&nbsp;流&nbsp;&nbsp;量：</span>
      <span class="flow-num">0</span>
      <span class="flow-right">GB</span>
    </div>
    <div class="payment-bd" style="text-align:left; margin-left:100px;">
      <a class="am-btn am-btn-success pull-left" onclick="get_caculate()"> <span>确定</span></a>
    </div>
    <div class="payment-bd" style="text-align:left; margin-left:100px;margin-right: 100px;line-height: 18px;width: auto;color:#660000">
      <span>注意：直播流量计算器是将所有因素预估到最大值进行测算，以实际消耗的流量为准。</span>
    </div>
  </div>
</div>










        </div>

    <script type="text/javascript">
function get_caculate(){
  var kbps = $(".selected").data('value')/8;
  var time = $("#live-length").val()*60;
  var num = $("#live-num").val();
  console.log("流量:"+(kbps*time*num)/(1024*1024))
  $(".flow-num").text(
    Math.ceil(((kbps*time*num))/(1024*1024))
    );
}
function get_qrcode_flow(){
  $("#payment-ft").show();
  if (!typeof(check)=="undefined") {
      clearInterval(check);
  };

  $.ajax({
      type: "post",
      url: "/qwtwzba/get_qrcode",
      data: { data: $('#pricef-num').text() ,stream:$(".selectedf").data('type'),type:'stream'},
      dataType: "json",
      success: function(res) {
        stream_data = $(".selectedf").data('type');
        $('#payment-lg').html(res.imgurl);
        flag = 1;
        check = setInterval(function() {
        if (!flag) {
            clearInterval(check);
        } else {
            $.ajax({
                method: "post",
                url: "/qwtwzba/notify",
                data: { "qrid": res.imgid,stream_data:stream_data,type:'stream'},
                dataType: "html",
                success: function(data) {
                     console.log(res.imgid);
                    if (data) {
                        $(".mask").fadeOut(500);
                        alert(data);
                        flag = false;
                    } else {
                        console.log(2);
                    }
                }
            });
        }
      }, 1000);
      }
  });
}
$(document).on('click','#flowperchase',function(){
    $(".buybox").fadeIn(500);
    get_qrcode_flow();
});
$(document).on('click','#caculator',function(){
    $(".caculator").fadeIn(500);
});
$(document).on('click','.close',function(){
    $(".buybox").fadeOut(500);
    $(".caculator").fadeOut(500);
    clearInterval(check);
});
$(document).on('click','.radio-box',function(){
  $(this).parent().parent().children().removeClass('selected');
  $(this).parent().addClass('selected');
});
$(document).on('click','.radio-boxf',function(){
    clearInterval(check);
    $(this).parent().parent().children().removeClass('selectedf');
    $(this).parent().addClass('selectedf');
    $('#pricef-num').text($('.selectedf').data('value'));
    get_qrcode_flow();
});
    </script>
